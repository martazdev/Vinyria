---
import type { CollectionEntry } from 'astro:content';
import Layout from './Layout.astro';
import { BadgeCheck, Star } from 'lucide-react';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage, recommended, affiliateLink, rating = 5 } = Astro.props;

// Create array for stars
const stars = Array.from({ length: 5 }, (_, i) => i < Math.round(rating));
---

<Layout title={title} description={description} image={heroImage}>
  <article class="max-w-4xl mx-auto px-6 md:px-12 py-12">
    <!-- Hero Image -->
    {heroImage && (
      <div class="relative w-full h-64 md:h-[400px] rounded-2xl overflow-hidden mb-8 shadow-lg group">
        {affiliateLink ? (
          <a href={affiliateLink} target="_blank" rel="noopener noreferrer" class="block w-full h-full relative cursor-pointer" aria-label={`Buy ${title}`}>
            <img src={heroImage} alt={title} class="w-full h-full object-cover group-hover:scale-105 transition duration-500" />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition duration-300"></div>
            {recommended && (
                <div class="absolute top-4 right-4 bg-amber-500 text-slate-900 px-3 py-1 rounded-full font-bold text-sm shadow-md flex items-center gap-1 z-10 pointer-events-none">
                    <BadgeCheck size={16} /> Recommended
                </div>
            )}
             <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300 pointer-events-none">
                <span class="bg-white/90 backdrop-blur-sm text-slate-900 font-bold px-6 py-2 rounded-full shadow-lg transform translate-y-4 group-hover:translate-y-0 transition duration-300">
                    Check Price
                </span>
             </div>
          </a>
        ) : (
          <>
            <img src={heroImage} alt={title} class="w-full h-full object-cover" />
             {recommended && (
                <div class="absolute top-4 right-4 bg-amber-500 text-slate-900 px-3 py-1 rounded-full font-bold text-sm shadow-md flex items-center gap-1">
                    <BadgeCheck size={16} /> Recommended
                </div>
            )}
          </>
        )}
      </div>
    )}

    <!-- Header -->
    <header class="text-center mb-10 max-w-2xl mx-auto">
      <div class="flex items-center justify-center gap-4 mb-4 text-sm text-slate-500 font-medium">
         <time datetime={pubDate.toISOString()}>{pubDate.toLocaleDateString('en-us', {
             year: 'numeric',
             month: 'long',
             day: 'numeric',
         })}</time>
         
         <div class="flex items-center gap-1 text-amber-500 bg-amber-50 px-2 py-1 rounded-full border border-amber-100">
             {stars.map((isFilled) => (
               <Star size={14} fill={isFilled ? "currentColor" : "none"} strokeWidth={2.5} class={isFilled ? "" : "text-gray-300"} />
             ))}
             <span class="text-slate-700 font-bold ml-1">{rating}/5</span>
         </div>
      </div>

      <h1 class="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight leading-tight mb-4">
        {title}
      </h1>
      <p class="text-xl text-slate-600 leading-relaxed">
        {description}
      </p>
    </header>

    <!-- BLUF Box (Bottom Line Up Front) -->
    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-6 my-8 rounded-r-xl shadow-sm not-prose">
        <h3 class="text-indigo-900 font-bold text-lg mb-2 flex items-center gap-2">
            Bottom Line Up Front
        </h3>
        <p class="text-indigo-800 leading-relaxed">
            In a hurry? Here's the verdict: This product offers the best value for money in its category. 
            We recommend it for users who prioritize performance and durability. 
            <a href="#conclusion" class="underline hover:text-indigo-600 font-semibold">Read our full verdict below.</a>
        </p>
    </div>

    <!-- Content -->
    <div class="prose prose-lg prose-slate mx-auto
        prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-slate-900
        prose-a:text-emerald-700 prose-a:no-underline hover:prose-a:underline
        prose-img:rounded-xl prose-img:shadow-md
    ">
      <slot />
    </div>
  </article>
</Layout>
